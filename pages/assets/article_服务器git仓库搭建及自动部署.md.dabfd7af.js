import{_ as a,c as n,a as e,d as l,o,r as p}from"./app.9feacaa1.js";const t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJcAAAAqCAIAAAAxqV6FAAAE50lEQVR4Xu2YaU8iSRiA519sst/2U2uH0Zk0eBAPHDBe4zVB12OiCCriEa8FRZ31YlZwUHFQPIhyI7Qt2GNMRhHmr21Vc44ctpNNdqe2kicEqt+qSvqpeustXvz6y29FAiHmp+YFtogA2CIKYIsogC2iALaIAtgiCmCLKIAtogC2iALYIgpgiyjwbIulHdpF/erExKCYpLKfYv4Vnm2RGj27/PKNZg+6scX/DNgiCmCLKIAtosATFgmyTCxfWrMxTibi9QW29JrmiccWCXJo9SoGGgGejUHQImyd1VuC53QkyMb8BhUXI+reioAAn0GZPQtAbrgHT11/9oHvr3ssDjZGsxHzWEMqoHrKHQCNIe+YVJTd/X/OExbFCpvjGhqir+89l/fAio+5y7LYr3PfOGiogbbpJB2GI05qIPwAPk8X5fGw2tkADLDOUiRFkMLaHq16UqdWyEvhz1rVZ9hld1zGDSjp2b6FwRd7na/hLIRwZDMIvD4czncW4xyQRSGLRJnaQMOX67WttVaWgX0patOafNGcGZXotcC9wgQOXFG/Y2+gsUY87gKRlonEfiLfW2GAc10KtTVN2LnFETC1wJ+dMy4g6W6pK7kyxJOmS9ASPZxrLyJF9QsMCA6ef2woxQpzUMgiNWIPwszGTDekG0UaRwGL8BHjVElgSzln0TBYngio/3AMRruyvBNQRMnwRih2cRWhWaeynCIESpCTadarrkmPKR4784H4y5P+pmkzfBrWdVRmzohJUcjiu00uefpNzRnC8lU3KYt2fXcR9+ilpLe7TyWrTG6vUrUhHEtok60csVGT+STA3uraKaJidicpOD2goEltg1naw3wFn+cbildZuZQgB/XeG4c/F/b1+nTO5xXGP5JnGP9InmH5yGuRIKsUe9zeOl2u5m2RZkMzjbmnJMj2GScX0EQJBmwB8GV47ZSNmdV1RPO6HfT9fiJAcePacXx/h88VFTmGJUjlWjhRWD2C9htTi49nGP9InmH8I3mG5aOAxRolV3HQ9uWqZ1h0j1TlnpIgK/o/RUGFstorlOkY+vqkr3zceB1zrPQV9cC+ga3RzMoFlLXSOX8iS7MRy1RLfItjsilgUfS7ERaZtM/Y9E9YBNQvXIG+Zk3zwG6Udm/KSPkfnhioWuu4E/Rovi0zuFim/xwCA34xWxl4PDOuYe64xWST1yKgetrHCQuMv0lt/OSF4YcsliiPL+HdY17rjQV3JkvI6qH9GH1h1OhDoBw1DFSkR3vZojmC90v39riQ6l/ycqXy/mwF3o65KGSRqFs85C6Lrl3tGwqUG9UShTl+F/wxi8TbzTOQOffsZjZm13eBlrcrN6De2d5/yDxQwVqpmXRdwP3nVHFVK/Xe6oaDfzWp4IUS84iCFklx6wcmcTKF79wMeNeRA6uHe6F5bv3sg4errDaGanIMSE2ZYC0aAYaMyirQUqZxgi4XMHOe9FNJ/ZL5HQa0PFhn2uInJUFKhyxcwUwf9yWLXkyKQhYBRIm0fcZicd/6Qncux7l+TP5Kumx7bDH9D1yK7dHaHKORXVouN9IsO9fC6ZF/8sRXiedjQ1yYoEFlhcKCzr8aM+/4dQvgmISJwTQmxHn1e56wiPkpwBZRAFtEAWwRBbBFFMAWUQBbRAFsEQWwRRTAFlEAW0QBbBEFsEUU+Bs3XHaP0mw7ogAAAABJRU5ErkJggg==",c="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAAAnCAIAAABi9SZlAAADCklEQVR4Xu2Y709SURjH/S/aetera3ekLy6FNRVdOH+W1dApNkwwmT/aJJOiLH/dJioqZlOBFSAG16OgJ9eLAk7/Wude0GbcXa/uzna2Z/uMcc/5PucwPuze51Bx/dqNSpMZYJcKUMg6oJB5QCHzgELmAYXMAwqZBxQyDyhkHlDIPKCQeUAh84BC5gGFzGOAQo4fmM6Q/e+/Kcm5fjpifuD1h/a+otweJinRrWRudy/kaOCb6CpfgWIXf9HZxAdH+RSgjSEK+3w7xzEkO0CbvoZH4pZiVDrM09fIG3sxZvVKcmDDK/ACx5utPZOeMZ/nmb1avrS6P8klqyO28vUBbQxQWITrDUmYoAPpc6KQiq05W+rvjSSoldBoczHAP92QA/HZ+7Kz1tGo7AxJi+3y5ePxBEH459suoXxlQBuDFcpWDuLuBnnEoigU+y2lQNP7baowE3piEriqwbksSWdyCMddFoEzueitGOFdTz0ovDBaCjm+3797HEupEZ1t4s983acKo/7uSmXqVkNvt8Ntu1uKcdUe8ZCUnNmmtnBhMRiW8A9fp8DVeFdO7F5oX51JnTH9SZ0x/UmdMVW0FbpmDkt9yj+gVKBNTSHC2fEW9f04vnM8rgRaBZNzU6JvBmcimAQ9jVzbbJTWRt7VKWvq31dnUmdMf1JnTH9SZ0wVLYUX4kThzvNa9f04vqZvuYBwfrrXbPMdoKOwwzISOCKxKUdlj1wrLQzd1PysgCpXp5DS9DpDf1bB4TbnagHtzNt4+6skoT1qo/LU3Jp4WF4CnMuVKqxybe/Lx4yJyV2ytzJWxdcNrBOUDgz7swgXRGdNeQlwLleqkOuY/0JvmGvRICZRfxcd6Zg6pg3O0npe4yEKaGOAwjNHe5xPKn3U3EC9SlJ4sSh3nrk0JgFXLR25MxynJeksdR/uE0DhZTBE4d8/2E5ZGrKqJbvoLVQxjV+2K82nfTlZPE0mPzZDL3MpDFAI/F9AIfOAQuYBhcwDCpkHFDIPKGQeUMg8oJB5QCHzgELmAYXMAwqZ5w+EucoVRMT9wgAAAABJRU5ErkJggg==",F=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[{"level":2,"title":"服务器 git 仓库搭建","slug":"服务器-git-仓库搭建","link":"#服务器-git-仓库搭建","children":[{"level":3,"title":"服务器安装 git","slug":"服务器安装-git","link":"#服务器安装-git","children":[]},{"level":3,"title":"创建仓库","slug":"创建仓库","link":"#创建仓库","children":[]},{"level":3,"title":"拉取","slug":"拉取","link":"#拉取","children":[]}]},{"level":2,"title":"自动拉取及部署","slug":"自动拉取及部署","link":"#自动拉取及部署","children":[{"level":3,"title":"主要使用 git 提供的 hooks 实现","slug":"主要使用-git-提供的-hooks-实现","link":"#主要使用-git-提供的-hooks-实现","children":[]}]},{"level":2,"title":"git 远程 ssh 相关","slug":"git-远程-ssh-相关","link":"#git-远程-ssh-相关","children":[]}],"relativePath":"article/服务器git仓库搭建及自动部署.md"}'),i={name:"article/服务器git仓库搭建及自动部署.md"},r=l(`<h2 id="服务器-git-仓库搭建" tabindex="-1">服务器 git 仓库搭建 <a class="header-anchor" href="#服务器-git-仓库搭建" aria-hidden="true">#</a></h2><h3 id="服务器安装-git" tabindex="-1">服务器安装 git <a class="header-anchor" href="#服务器安装-git" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apt-get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">git</span></span>
<span class="line"></span></code></pre></div><h3 id="创建仓库" tabindex="-1">创建仓库 <a class="header-anchor" href="#创建仓库" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/www</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">init</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--bare</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">project_code.git</span></span>
<span class="line"></span></code></pre></div><p>由于服务器上的仓库是存放代码的，不需要修改及提交等操作</p><p>因此这里加了 <code>--bare</code> 参数，用于创建一个裸仓库</p><h3 id="拉取" tabindex="-1">拉取 <a class="header-anchor" href="#拉取" aria-hidden="true">#</a></h3><p>假设服务器已开放 <code>ssh</code> 访问，这里以 <code>root</code> 用户拉取 <code>192.168.0.1</code> 服务器上的 <code>/www/project_code.git</code> 仓库为例</p><p>在本地执行</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">clone</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root@192.168.0.1:/www/project_code.git</span></span>
<span class="line"></span></code></pre></div><p>按照提示输入密码，即可正常拉取及修改提交</p><p>拉取路径 <code>root@IP:/www/project_code.git</code> 中 <code>@</code> 符号前面的用户可以为服务器上任意用户</p><h2 id="自动拉取及部署" tabindex="-1">自动拉取及部署 <a class="header-anchor" href="#自动拉取及部署" aria-hidden="true">#</a></h2><h3 id="主要使用-git-提供的-hooks-实现" tabindex="-1">主要使用 git 提供的 hooks 实现 <a class="header-anchor" href="#主要使用-git-提供的-hooks-实现" aria-hidden="true">#</a></h3><p>进入到刚刚创建的裸仓库目录</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/www/project_code.git/hooks</span></span>
<span class="line"></span></code></pre></div><p>可以看到有不少的文件，这些文件是一些示例，表示我们可以在 git 的各个声明周期做一些我们需要的事情</p><p>当 git 执行到不同的生命周期阶段时，会执行这些文件，因此可以在这些文件里面写上自己需要的脚本</p><p>例如我们可以在服务器上建另外一个工作仓库，然后通过脚本进入到这个仓库并拉取代码，最后打包</p><p>这样就可以自动拉取并部署了，以下面脚本为例，首先创建 <code>post-receive</code></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">vim</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">post-receive</span></span>
<span class="line"></span></code></pre></div><p>写入以下内容：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">#!/bin/sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 注意上面第一行非注释，且必须要位于第一行</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">unset</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">GIT_DIR</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">DeployPath</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/www/project_code</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> $DeployPath</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">fetch</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--all</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">reset</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--hard</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">origin/master</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pull complete =========</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">build complete =========</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">exit</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"></span></code></pre></div><p>然后给这个脚本权限</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">post-receive</span></span>
<span class="line"></span></code></pre></div><p>然后在服务器创建一个仓库，关联裸仓库</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">clone</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/www/project_code.git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">project_code</span></span>
<span class="line"></span></code></pre></div><p>现在在本地 <code>push</code> 后，就会触发服务器端 <code>project_code.git</code> 的 <code>hooks</code></p><p>进而执行 <code>post-receive</code> 里面的脚本，然后自动拉取代码并部署</p><h2 id="git-远程-ssh-相关" tabindex="-1">git 远程 ssh 相关 <a class="header-anchor" href="#git-远程-ssh-相关" aria-hidden="true">#</a></h2><ol><li>例如用户是 <code>git</code>，则 <code>/home/git/.ssh/authorized_keys</code> 文件内存放公钥</li><li>例如用户是 <code>git</code>，需注意创建裸仓库时用这个用户创建不要用 <code>root</code>，如果用了 <code>root</code> 记得给权限</li><li><code>.ssh</code> 文件夹权限需要是 700，即<img src="`+t+'" alt="img.png"></li><li><code>authorized_keys</code> 文件权限至少是 600，即<img src="'+c+`" alt="img_1.png"></li><li>另外需要注意 <code>.ssh</code> 和 <code>authorized_keys</code> 的所属用户都要设置为自己新增的用户例如</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">chown</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-R</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">git:git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./git/.ssh</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># -R 表示同时为其子文件、目录设置</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># : 前表示用户，后面表示组</span></span>
<span class="line"></span></code></pre></div>`,33);function d(A,C,g,h,y,D){const s=p("VisitLog");return o(),n("div",null,[r,e(s)])}const m=a(i,[["render",d]]);export{F as __pageData,m as default};
